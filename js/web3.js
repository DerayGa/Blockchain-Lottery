var web3, eth, lotteryserviceContract, lotteryservice, contractOwner;

$(function() {
  // 連結 enode
  web3 = new Web3(new Web3.providers.HttpProvider('http://localhost:8545'));
  eth = web3.eth;
  contractOwner = web3.eth.accounts[0];
  //部屬
  lotteryserviceContract = web3.eth.contract([{"constant":true,"inputs":[],"name":"creator","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"num","type":"uint8[5]"}],"name":"betting","outputs":[],"payable":true,"type":"function"},{"constant":false,"inputs":[{"name":"seed","type":"uint256"}],"name":"randomGen","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"checkMyBetLog","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"cheatLottery","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"remove","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"lottery","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"checkAllBetLog","outputs":[],"payable":false,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"player","type":"address"},{"indexed":false,"name":"timestamp","type":"uint256"}],"name":"BettingSuccess","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"player","type":"address"},{"indexed":false,"name":"msg","type":"string"},{"indexed":false,"name":"timestamp","type":"uint256"}],"name":"BettingFailed","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"numbers","type":"uint8[5]"},{"indexed":false,"name":"timestamp","type":"uint256"},{"indexed":true,"name":"player","type":"address"}],"name":"BetLog","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"timestamp","type":"uint256"},{"indexed":true,"name":"player","type":"address"}],"name":"NoBetLog","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"numbers","type":"uint8[]"},{"indexed":false,"name":"timestamp","type":"uint256"}],"name":"LotteryNumbers","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"amount","type":"uint256"}],"name":"TotalBetAmount","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"timestamp","type":"uint256"}],"name":"NoWinner","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"player","type":"address"},{"indexed":false,"name":"amount","type":"uint256"},{"indexed":false,"name":"timestamp","type":"uint256"}],"name":"LotteryWinner","type":"event"}]);
  lotteryservice = lotteryserviceContract.new(
     {
       from: web3.eth.accounts[0],
       data: '0x606060405234610000575b33600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5b6117408061005c6000396000f3006060604052361561008c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806302d05d3f146100915780630fee0ab8146100e0578063434b14e71461011b5780637d3c6185146101525780638192d6ba14610161578063a7f4377914610170578063ba13a5721461017f578063c0c4bf9a1461018e575b610000565b346100005761009e61019d565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6101196004808060a0019060058060200260405190810160405280929190826005602002808284378201915050505050919050506101c3565b005b3461000057610136600480803590602001909190505061068c565b604051808260ff1660ff16815260200191505060405180910390f35b346100005761015f6106d3565b005b346100005761016e6108a2565b005b346100005761017d610a62565b005b346100005761018c610af6565b005b346100005761019b610f05565b005b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600a60ff16670de0b6b3a76400003481156100005704141561051e57600280548060010182818154818355818115116102605760030281600302836000526020600020918201910161025f91905b8082111561025b576000600082016000905560018201600090556002820160006101000a81549073ffffffffffffffffffffffffffffffffffffffff021916905550600301610211565b5090565b5b505050916000526020600020906003020160005b6060604051908101604052808581526020014281526020013373ffffffffffffffffffffffffffffffffffffffff168152509091909150600082015181600001906005826005601f016020900481019282156103405791602002820160005b8382111561031157835183826101000a81548160ff021916908360ff16021790555092602001926001016020816000010492830192600103026102d3565b801561033e5782816101000a81549060ff0219169055600101602081600001049283019260010302610311565b505b50905061037091905b8082111561036c57600081816101000a81549060ff021916905550600101610349565b5090565b50506020820151816001015560408201518160020160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550505050600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020805480600101828181548183558181151161044c5781836000526020600020918201910161044b91905b8082111561044757600081600090555060010161042f565b5090565b5b505050916000526020600020900160005b600160028054905003909190915055503373ffffffffffffffffffffffffffffffffffffffff167fb0321cd950dc9e61b6b07389923b09b32515c27b013263d774dcb902980aeaf9426040518082815260200191505060405180910390a27f8d9e9ca2b2c5fecd3a724db6a8c683e3bc016ac80a00eddb7ee221afc87070d3670de0b6b3a76400003073ffffffffffffffffffffffffffffffffffffffff1631811561000057046040518082815260200191505060405180910390a1610688565b600a60ff16670de0b6b3a7640000348115610000570411156105c6573373ffffffffffffffffffffffffffffffffffffffff167f5b1922653b9a12b267af5f88aaf8380c5dea6179372d166f58d33f964f3cc961426040518080602001838152602001828103825260128152602001807fe4b88be6b3a8e98791e9a18de9818ee5a49a00000000000000000000000000008152506020019250505060405180910390a261064e565b3373ffffffffffffffffffffffffffffffffffffffff167f5b1922653b9a12b267af5f88aaf8380c5dea6179372d166f58d33f964f3cc961426040518080602001838152602001828103825260128152602001807fe4b88be6b3a8e98791e9a18de4b88de8b6b300000000000000000000000000008152506020019250505060405180910390a25b3373ffffffffffffffffffffffffffffffffffffffff166108fc349081150290604051809050600060405180830381858888f19350505050505b5b50565b60006001600a60ff1660014303408460405180836000191660001916815260200182815260200192505050604051809103902060019004811561000057060190505b919050565b600060006000600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000209250600091505b82805490508260ff161015610840576002838360ff16815481101561000057906000526020600020900160005b5054815481101561000057906000526020600020906003020160005b5090508060020160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff167f0b8a5b11fc0ca5ae9da7030f6818c3545e327dc85b249c24beb7e85efc83aee082600001836001015460405180836005801561081e576020028201916000905b82829054906101000a900460ff1660ff16815260200190600101906020826000010492830192600103820291508084116107e75790505b50508281526020019250505060405180910390a25b818060010192505061071f565b60008380549050141561089c573373ffffffffffffffffffffffffffffffffffffffff167f56bb25bd7020a5d66c207321ae17c712db7b1aaf0f52fcb6472af69f92a5c826426040518082815260200191505060405180910390a25b5b505050565b6108aa611078565b60a060405190810160405280600760ff168152602001600860ff168152602001600960ff168152602001600a60ff168152602001601460ff16815250600490600582805482825590600052602060002090601f016020900481019282156109815791602002820160005b8382111561095257835183826101000a81548160ff021916908360ff1602179055509260200192600101602081600001049283019260010302610914565b801561097f5782816101000a81549060ff0219169055600101602081600001049283019260010302610952565b505b5090506109b191905b808211156109ad57600081816101000a81549060ff02191690555060010161098a565b5090565b50507f268d298f3b783a8c524cb92b3d87cbed198509ea2d076d49851e29963d190f9f60044260405180806020018381526020018281038252848181548152602001915080548015610a4857602002820191906000526020600020906000905b82829054906101000a900460ff1660ff1681526020019060010190602082600001049283019260010382029150808411610a115790505b5050935050505060405180910390a1610a5f611119565b5b565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415610af357600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16ff5b5b565b600060006000600060006000610b0a611078565b429550600280549050860195506000600681815481835581811511610b5b57818360005260206000209182019101610b5a91905b80821115610b56576000816000905550600101610b3e565b5090565b5b5050505060068054806001018281815481835581811511610ba857818360005260206000209182019101610ba791905b80821115610ba3576000816000905550600101610b8b565b5090565b5b505050916000526020600020900160005b60009091909150555060068054806001018281815481835581811511610c0b57818360005260206000209182019101610c0a91905b80821115610c06576000816000905550600101610bee565b5090565b5b505050916000526020600020900160005b6002600280549050811561000057049091909150555060068054806001018281815481835581811511610c7b57818360005260206000209182019101610c7a91905b80821115610c76576000816000905550600101610c5e565b5090565b5b505050916000526020600020900160005b60016002805490500390919091505550600094505b600680549050851015610d2d576002600686815481101561000057906000526020600020900160005b5054815481101561000057906000526020600020906003020160005b5093508360020160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1661ffff16860195508360010154860195505b8480600101955050610ca1565b5b60056004805490501015610e5057610d458661068c565b925060009150600090505b6004805490508160ff161015610db0578260ff1660048260ff1681548110156100005790600052602060002090602091828204019190065b9054906101000a900460ff1660ff161415610da257600191505b5b8080600101915050610d50565b8260ff1686019550811515610e4b5760048054806001018281815481835581811511610e1657601f016020900481601f01602090048360005260206000209182019101610e1591905b80821115610e11576000816000905550600101610df9565b5090565b5b50505091600052602060002090602091828204019190065b85909190916101000a81548160ff021916908360ff160217905550505b610d2e565b7f268d298f3b783a8c524cb92b3d87cbed198509ea2d076d49851e29963d190f9f60044260405180806020018381526020018281038252848181548152602001915080548015610ee557602002820191906000526020600020906000905b82829054906101000a900460ff1660ff1681526020019060010190602082600001049283019260010382029150808411610eae5790505b5050935050505060405180910390a1610efc611119565b5b505050505050565b60006000600091505b6002805490508260ff1610156110165760028260ff16815481101561000057906000526020600020906003020160005b5090508060020160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff167f0b8a5b11fc0ca5ae9da7030f6818c3545e327dc85b249c24beb7e85efc83aee0826000018360010154604051808360058015610ff4576020028201916000905b82829054906101000a900460ff1660ff1681526020019060010190602082600001049283019260010382029150808411610fbd5790505b50508281526020019250505060405180910390a25b8180600101925050610f0e565b60006002805490501415611073573373ffffffffffffffffffffffffffffffffffffffff167f56bb25bd7020a5d66c207321ae17c712db7b1aaf0f52fcb6472af69f92a5c826426040518082815260200191505060405180910390a25b5b5050565b60006004818154818355818115116110ca57601f016020900481601f016020900483600052602060002091820191016110c991905b808211156110c55760008160009055506001016110ad565b5090565b5b5050505060006005818154818355818115116111125781836000526020600020918201910161111191905b8082111561110d5760008160009055506001016110f5565b5090565b5b505050505b565b600060006000600060006000600095505b60028054905086101561147157600286815481101561000057906000526020600020906003020160005b50945060019350600092505b6004805490508360ff1610156112165760009150600090505b60058160ff1610156111fc5760048360ff1681548110156100005790600052602060002090602091828204019190065b9054906101000a900460ff1660ff16856000018260ff16600581101561000057602091828204019190065b9054906101000a900460ff1660ff1614156111ee57600191505b5b8080600101915050611179565b8380156112065750815b93505b8280600101935050611160565b83156112dd57600580548060010182818154818355818115116112655781836000526020600020918201910161126491905b80821115611260576000816000905550600101611248565b5090565b5b505050916000526020600020900160005b8760020160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550505b6003805480600101828181548183558181151161135e5760030281600302836000526020600020918201910161135d91905b80821115611359576000600082016000905560018201600090556002820160006101000a81549073ffffffffffffffffffffffffffffffffffffffff02191690555060030161130f565b5090565b5b505050916000526020600020906003020160005b8790919091506000820181600001906005826005601f016020900481019282156113bd5791601f016020900482015b828111156113bc5782548255916001019190600101906113a1565b5b5090506113ed91905b808211156113e957600081816101000a81549060ff0219169055506001016113c6565b5090565b5050600182015481600101556002820160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff168160020160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505050505b858060010196505061112a565b611479611502565b60006002818154818355818115116114f5576003028160030283600052602060002091820191016114f491905b808211156114f0576000600082016000905560018201600090556002820160006101000a81549073ffffffffffffffffffffffffffffffffffffffff0219169055506003016114a6565b5090565b5b505050505b505050505050565b60006000600060058054905092506000831415611555577f099cad0e8377df0f270631f9565e93ba4b9d1892ff1421c174110706cbff56a4426040518082815260200191505060405180910390a16116b0565b823073ffffffffffffffffffffffffffffffffffffffff1631811561000057049150600090505b6005805490508160ff1610156116af5760058160ff16815481101561000057906000526020600020900160005b9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc839081150290604051809050600060405180830381858888f193505050505060058160ff16815481101561000057906000526020600020900160005b9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff167fff8ab71428121b903312f0811ef90ea93038df4601bb6c494a2f185b39c3eb3d670de0b6b3a7640000848115610000570442604051808381526020018281526020019250505060405180910390a25b808060010191505061157c565b5b7f8d9e9ca2b2c5fecd3a724db6a8c683e3bc016ac80a00eddb7ee221afc87070d3670de0b6b3a76400003073ffffffffffffffffffffffffffffffffffffffff1631811561000057046040518082815260200191505060405180910390a15b5050505600a165627a7a723058208d5b70faf9bec854569a6e709cd7d77d7b51ec092310cb087750166cec91ccd60029', 
       gas: '4700000'
     }, function (e, contract){
        if (e) {
          showLog('錯誤', e);
          return;
        }
        if (typeof contract.address !== 'undefined') {
          showLog('Lottery Service 合約部屬完成!');
          contractControl();
        }
   })
  }
)